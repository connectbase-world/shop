# Shop 모노레포

React + TanStack Router + ConnectBase 기반의 쇼핑몰 프로젝트입니다.
고객용 쇼핑몰(`apps/shop`)과 관리자 패널(`apps/admin`) 두 개의 앱으로 구성된 모노레포 구조입니다.

## 기술 스택

- **React 19** + **TypeScript** (strict mode)
- **TanStack Router** — 파일 기반 라우팅
- **Vite 7** — 빌드 도구 및 개발 서버
- **Tailwind CSS v4** — 스타일링
- **ConnectBase** — 백엔드 (DB, 인증, 결제, 파일 저장)
- **pnpm workspace** — 모노레포 관리

## 프로젝트 구조

```
shop/
├── apps/
│   ├── shop/          # 고객용 쇼핑몰 SPA
│   └── admin/         # 관리자 패널 SPA
├── package.json       # 루트 workspace 설정
└── pnpm-lock.yaml
```

## 시작하기

```bash
# 의존성 설치
pnpm install

# 쇼핑몰 개발 서버 (포트 3000)
pnpm dev

# 어드민 개발 서버 (포트 3001)
pnpm dev:admin

# 전체 빌드
pnpm build:all
```

## 배포

```bash
# 쇼핑몰 빌드 + 배포
pnpm build:shop
cd apps/shop && npx connectbase-client deploy

# 어드민 빌드 + 배포
pnpm build:admin
cd apps/admin && npx connectbase-client deploy
```

---

## 쇼핑몰 (apps/shop)

고객이 상품을 탐색하고 구매할 수 있는 쇼핑몰 프론트엔드입니다.

### 페이지 구성

| 경로 | 설명 |
|------|------|
| `/` | 홈 — 추천 상품, 카테고리별 상품 |
| `/products` | 상품 목록 — 카테고리 필터, 정렬, 페이지네이션 |
| `/products/:productId` | 상품 상세 — 이미지 갤러리, 상세 설명, 리뷰, 장바구니/바로구매 |
| `/cart` | 장바구니 — 수량 변경, 삭제, 주문하기 |
| `/wishlist` | 찜 목록 — 찜한 상품 관리 |
| `/checkout` | 주문/결제 — 배송정보, 쿠폰, 마일리지, 결제 |
| `/payment/success` | 결제 성공 — 주문 확인, DB 저장 |
| `/payment/fail` | 결제 실패 — 에러 안내 |
| `/login` | 로그인 — Google/Naver OAuth |
| `/auth/callback` | OAuth 콜백 처리 |
| `/mypage` | 마이페이지 — 프로필, 쿠폰, 마일리지, 인플루언서, 주문내역 |
| `/coupon/:code` | 쿠폰 수령 — 링크 공유로 쿠폰 받기 |

### 주요 기능

#### 상품

- 카테고리별 상품 탐색 (상의, 하의, 아우터, 신발, 악세서리)
- 가격순/최신순 정렬
- 12개씩 페이지네이션
- 상품 상세에 다중 이미지 갤러리 + 상세 이미지
- 리뷰 작성/조회 (별점 1~5)

#### 장바구니 & 찜

- localStorage 기반 장바구니 (Context API)
- 수량 변경, 개별/전체 삭제
- 찜 목록 (하트 토글)
- 바로구매 기능 (장바구니 거치지 않고 즉시 결제)

#### 결제

- ConnectBase Payment API 연동 (토스페이먼츠)
- 쿠폰 코드 입력 또는 내 쿠폰에서 선택
- 마일리지 사용 (전액 사용 버튼)
- 배송비 자동 계산 (5만원 이상 무료배송, 미만 3,000원)
- 결제 성공 시 주문 DB 저장, 쿠폰 사용 기록, 마일리지 적립/사용 기록, 인플루언서 커미션 기록

#### 인증

- Google / Naver OAuth 소셜 로그인
- 로그인 시 자동 회원 등록 (members 테이블)
- 신규 회원 자동 쿠폰 발급 + 환영 마일리지 1,000원 지급

#### 쿠폰

- 쿠폰 코드 직접 입력
- 내 쿠폰 목록에서 선택 적용
- 쿠폰 링크 공유로 수령 (`/coupon/:code`)
- 정액/정률 할인 지원 (최대 할인 금액 제한)
- 카테고리/상품별 타겟 쿠폰
- 1인당 사용 횟수 제한

#### 마일리지 (적립금)

- 구매 시 3% 자동 적립 (상품금액 - 쿠폰할인 기준)
- 결제 시 마일리지 사용 가능 (1원 단위)
- 전액 사용 버튼
- 신규 가입 시 환영 마일리지 1,000원
- 마이페이지에서 잔액 및 내역 확인

#### 인플루언서 커미션

- 마이페이지에서 인플루언서 신청
- 승인 후 추천 링크 생성 (`?ref=INF_XXXXXX`)
- 추천 링크 복사 기능
- 커미션 현황 확인 (총 수익, 미정산, 정산 완료)
- 최근 커미션 내역 조회

#### 마이페이지

- 배송 정보 등록/수정 (체크아웃 시 자동 입력)
- 내 쿠폰 목록 (사용가능/사용완료/만료 상태별)
- 마일리지 잔액 + 최근 내역 (적립/사용/조정)
- 인플루언서 섹션 (미신청/심사중/승인/반려 상태별 UI)
- 주문 내역 (상태별 뱃지, 상세 펼치기)

---

## 어드민 (apps/admin)

쇼핑몰 운영을 위한 관리자 패널입니다.

### 페이지 구성

| 경로 | 설명 |
|------|------|
| `/` | 대시보드 — 매출/주문/회원 통계 |
| `/products` | 상품 관리 — 등록, 수정, 삭제, 이미지 업로드 |
| `/products/new` | 상품 등록 |
| `/products/:id/edit` | 상품 수정 |
| `/orders` | 주문 관리 — 상태 변경 (결제완료→준비중→배송중→배송완료) |
| `/members` | 회원 관리 — 목록, 상세, 쿠폰 지급, 마일리지 조정 |
| `/coupons` | 쿠폰 관리 — 등록, 수정, 삭제, 활성/비활성 토글 |
| `/coupons/new` | 쿠폰 등록 |
| `/coupons/:id/edit` | 쿠폰 수정 |
| `/influencers` | 인플루언서 관리 — 신청 승인/반려, 커미션 정산 |
| `/settings` | 설정 |

### 주요 기능

#### 대시보드

- 총 매출, 주문 수, 회원 수, 상품 수 통계
- 최근 주문 목록

#### 상품 관리

- 상품 CRUD (이름, 가격, 설명, 카테고리, 재고)
- 대표 이미지 + 추가 이미지 + 상세 이미지 업로드
- ConnectBase File Storage 연동
- 추천 상품 설정
- 상품 검색 및 카테고리 필터

#### 주문 관리

- 전체 주문 목록 (상태/기간별 필터)
- 주문 상태 변경 (결제완료 → 준비중 → 배송중 → 배송완료)
- 주문 상세 정보 (상품, 수령인, 주소, 쿠폰, 결제금액)

#### 회원 관리

- 회원 목록 (닉네임, 가입일, 최근 로그인)
- 회원 상세 모달 (4개 탭):
  - **주문 내역** — 해당 회원의 주문 목록
  - **리뷰** — 작성한 리뷰 목록
  - **쿠폰** — 보유 쿠폰 목록 + 관리자 직접 쿠폰 지급 기능
  - **마일리지** — 잔액 확인 + 관리자 마일리지 조정 (추가/차감 + 사유)

#### 쿠폰 관리

- 쿠폰 CRUD
- 정액(원)/정률(%) 할인 설정
- 적용 범위: 전체 / 카테고리 / 특정 상품
- 발급 수량 제한 (무제한 가능)
- 1인당 사용 횟수 제한
- 신규회원 자동 발급 옵션
- 활성/비활성 토글
- 쿠폰 링크 복사
- 인플루언서 연동 (쿠폰 사용 시 인플루언서에게 커미션 지급)

#### 인플루언서 관리

- 인플루언서 신청 목록 (전체/대기/승인/반려 필터)
- 승인 시 추천 코드 자동 생성 (INF_XXXXXX 형식)
- 반려 시 사유 입력 가능
- 인플루언서 상세 모달:
  - 기본 정보 (회원ID, 추천코드, 신청일/승인일)
  - 커미션 비율 수정 (기본 5%)
  - 커미션 현황 (총 수익, 미정산, 정산 완료)
  - 커미션 내역 리스트 (날짜, 경로, 주문금액, 커미션, 상태)
  - 미정산 일괄 정산 버튼
- 통계 카드 (총 인플루언서, 승인 활동중, 승인 대기, 미정산 금액)

---

## 데이터베이스 구조

ConnectBase JSON Database를 사용합니다.

| 테이블 | 설명 |
|--------|------|
| `products` | 상품 (이름, 가격, 설명, 이미지, 카테고리, 재고) |
| `orders` | 주문 (주문번호, 상품목록, 결제금액, 배송정보, 상태) |
| `profiles` | 회원 배송 프로필 (이름, 연락처, 주소) |
| `members` | 회원 정보 (member_id, 닉네임, 소셜 provider, 최근 로그인) |
| `reviews` | 상품 리뷰 (별점, 내용) |
| `coupons` | 쿠폰 마스터 (코드, 할인정보, 적용범위, 수량, 기간) |
| `user_coupons` | 회원별 쿠폰 보유/사용 기록 |
| `mileage_history` | 마일리지 변동 내역 (적립/사용/조정, 잔액) |
| `influencers` | 인플루언서 프로필 (추천코드, 상태, 커미션율, 수익) |
| `commissions` | 커미션 기록 (주문별 커미션 금액, 경로, 정산상태) |

---

## 인플루언서 커미션 흐름

```
1. 회원이 마이페이지에서 인플루언서 신청
2. 관리자가 어드민에서 승인 → 추천 코드(INF_XXXXXX) 자동 생성
3. 인플루언서가 추천 링크 공유: https://shop-url.com?ref=INF_XXXXXX
4. 고객이 추천 링크로 접속 → ref_code가 localStorage에 저장
5. 고객이 상품 구매 → 결제 성공 시 커미션 자동 기록
   - 추천 링크 경유 (1순위)
   - 인플루언서 연동 쿠폰 사용 (2순위)
   - 자기 추천 방지 (본인 구매 시 커미션 미지급)
6. 관리자가 어드민에서 미정산 커미션 확인 후 일괄 정산 처리
```

---

## 마일리지 흐름

```
1. 신규 가입 시 환영 마일리지 1,000원 자동 지급
2. 구매 시 3% 적립 (상품금액 - 쿠폰할인 기준, 배송비 제외)
3. 체크아웃에서 마일리지 사용 가능 (1원 단위, 전액 사용 버튼)
4. 관리자가 어드민에서 수동 조정 가능 (추가/차감 + 사유)
5. balance_after 필드로 잔액 추적 (가장 최근 기록의 잔액이 현재 잔액)
```

---

## 쿠폰 흐름

```
1. 관리자가 어드민에서 쿠폰 생성 (코드, 할인정보, 적용범위, 기간)
2. 고객이 쿠폰을 받는 방법:
   - 신규 가입 시 자동 발급 (is_auto_issue 쿠폰)
   - 쿠폰 링크 접속 (/coupon/CODE)
   - 관리자가 회원 상세에서 직접 지급
3. 체크아웃에서 코드 입력 또는 내 쿠폰에서 선택
4. 할인 적용: 정액 / 정률 (최대할인 제한), 카테고리/상품 타겟
5. 결제 성공 시 사용 기록 저장
```
